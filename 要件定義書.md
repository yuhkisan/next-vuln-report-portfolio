# 依存パッケージ脆弱性スキャナ 要件定義書

> 注意: 本文書は初期構想です。現行仕様は `docs/BEHAVIOR_SPEC.md` / `docs/USER_MANUAL.md` / `PORTFOLIO_A_PLAN.md` を参照してください。
> 以降はアーカイブとして扱い、通常は更新しません。

## 1. 概要

### 1.1 システム名（仮）

Dependency Vulnerability Scanner

### 1.2 システム概要

本システムは、フロントエンドプロジェクトの `package.json` をアップロードし、含まれる npm 依存パッケージに既知の脆弱性が存在するかを解析・可視化する Web アプリケーションである。

外部の脆弱性データベース（OSV.dev）から脆弱性情報を取得し、

- 依存パッケージの解析
- 脆弱性の一覧表示
- Severity や SSVC 風優先度によるフィルタ・ソート
- プロジェクト単位での結果保存（ブラウザ内）

を行う。Next.js + React + TypeScript + MUI を用いたポートフォリオ用途のツールとして位置づける。

---

## 2. 目的

1. React / Next.js / TypeScript / MUI / Storybook / テストを組み合わせた、実務的なフロントエンド〜簡易バックエンドのスキルを示す。
2. SES 現場での脆弱性管理アプリ開発経験を踏まえ、実際の業務に近いユースケース（依存パッケージの脆弱性管理）を再現する。
3. ただの「一覧表示」ではなく、優先度付けやプロジェクト管理を通して、業務アプリとしての設計力をアピールする。

---

## 3. 想定ユーザー

- **開発者本人（ポートフォリオ制作者）**
  自身のスキル確認・学習用。

- **採用担当者・技術面接官**
  デモ画面やコードを通して、フロントエンドエンジニアとしてのスキルセットや設計力を評価する。

---

## 4. 用語定義

- **依存パッケージ**: `package.json` の `dependencies` および `devDependencies` に記載された npm パッケージ。
- **脆弱性**: 特定のパッケージ・バージョンに対する既知のセキュリティ問題。OSV.dev の脆弱性情報を指す。
- **SSVC**: Stakeholder-Specific Vulnerability Categorization。脆弱性の対応優先度を決定する考え方。本システムでは簡略化した独自ロジックを用いる。
- **プロジェクト**: 1 つの `package.json` と、その解析結果・SSVC 設定などをまとめた論理単位。

---

## 5. 前提条件・対象範囲・非対象

### 5.1 前提条件

- 対象パッケージマネージャは npm のみとする。
- 入力ファイルは `package.json`（JSON 形式）1 ファイルを対象とする。
- バージョン指定は `^1.2.3` 等の範囲指定を簡略化し、代表値（例：`1.2.3`）として扱う。
- データ永続化にはブラウザの `localStorage` を利用し、サーバーサイドのデータベースは使用しない。
- 外部脆弱性 DB は OSV.dev のみを利用する。

### 5.2 対象外

- 商用サービスとしての本番レベルの可用性・セキュリティ・スケーラビリティ保証。
- npm 以外（Maven, PyPI など）への対応。
- lock ファイル（`package-lock.json`, `yarn.lock` など）の解析。
- 組織・チームでの運用機能（ワークフロー、通知、権限管理等）。

---

## 6. ユースケース定義

### UC-01: package.json を解析して脆弱性一覧を確認する

1. ユーザーはトップ画面で `package.json` をドラッグ＆ドロップまたはファイル選択でアップロードする。
2. システムは JSON を解析し、`dependencies` / `devDependencies` から依存パッケージ一覧を抽出する。
3. システムは OSV.dev API に対し、パッケージ名・バージョン情報を送信して脆弱性情報を取得する。
4. システムは取得した脆弱性情報を一覧化し、サマリーカードとテーブルで表示する。

### UC-02: 脆弱性一覧をフィルタ・ソートする

1. ユーザーは Severity（ALL / LOW / MEDIUM / HIGH / CRITICAL）を指定して一覧を絞り込む。
2. ユーザーはパッケージ名・脆弱性 ID でテキスト検索を行う。
3. ユーザーはソート条件（パッケージ名 / Severity / SSVC 優先度）を変更する。
4. システムは条件に応じて一覧を再表示する。

### UC-03: SSVC 風優先度を設定し、優先度順に並べ替える

1. ユーザーは SSVC 設定画面を開き、Severity 重みや devDependencies ペナルティなどを設定する。
2. システムは設定値に基づいて各脆弱性のスコアを計算し、カテゴリ（例：IMMEDIATE / SOON / LATER）を付与する。
3. ユーザーはソート条件として「SSVC 優先度」を選択する。
4. システムは SSVC スコア／カテゴリ順に一覧を並べ替える。
5. SSVC 設定が未設定の場合、「先に設定を行ってください」という案内を出し、設定画面を表示する。

### UC-04: プロジェクトとして結果を保存・再閲覧する（デモユーザー）

1. デモユーザーが解析完了後、「プロジェクトとして保存」操作を行う。
2. システムは `localStorage` にプロジェクト情報（package.json, サマリー, SSVC 設定等）を保存する。
3. サイドバーのプロジェクト一覧に保存済みプロジェクトが表示される。
4. ユーザーは任意のプロジェクトを選択し、保存済みの解析結果を再表示できる。
5. ユーザーは必要に応じて「再スキャン」を実行し、最新の脆弱性情報を取得・更新できる。

### UC-05: ゲスト利用

1. ユーザーはログインせずにアクセスし、`package.json` をアップロード・解析できる。
2. システムは「ゲストモードのため、リロードすると結果は消えます」と案内を表示する。
3. ユーザーは解析結果を閲覧・フィルタ・ソートできるが、プロジェクト保存はできない。
4. ページリロード時に状態はリセットされる。

---

## 7. 機能要件

### 7.1 ファイルアップロード機能

- `package.json` をドラッグ＆ドロップまたはファイル選択でアップロードできること。
- JSON 形式以外のファイルの場合、エラーメッセージを表示すること。
- サイズ上限（例：5MB）を超えるファイルはアップロード不可とし、エラーメッセージを表示すること。

### 7.2 依存パッケージ解析機能

- `dependencies` / `devDependencies` を解析し、パッケージ名・バージョン指定文字列・種別(runtime/dev)を抽出すること。
- バージョン範囲指定は簡易的に代表バージョンへ変換すること（厳密な解決は行わない）。

### 7.3 脆弱性情報取得機能

- OSV.dev API に対して、npm エコシステム・パッケージ名・バージョン情報を用いて脆弱性情報を取得すること。
- 取得する情報には、脆弱性 ID、要約、Severity、影響バージョン、修正バージョン、参考 URL を含めること。
- 通信エラー時はユーザーにエラーを通知しつつ、可能な範囲で処理を継続すること。

### 7.4 脆弱性一覧表示機能

- サマリーカードとして以下を表示すること：

  - 依存パッケージ数
  - 脆弱性総数
  - HIGH 以上の脆弱性数

- テーブル形式で脆弱性一覧を表示すること：

  - パッケージ名
  - バージョン指定
  - 脆弱性 ID
  - Severity（色付きラベル）
  - SSVC カテゴリ（設定済みの場合）
  - 詳細表示アクション

### 7.5 フィルタ・ソート機能

- Severity によるフィルタリング機能を提供すること。
- パッケージ名・脆弱性 ID のテキスト検索機能を提供すること。
- ソート条件として「パッケージ名 / Severity / SSVC 優先度」を選択可能とすること。
- SSVC 設定が未設定の状態で SSVC ソートを選択した場合、設定を促すメッセージを表示し、ソートは行わないこと。

### 7.6 SSVC 風優先度付与機能

- SSVC 概念を簡略化し、Severity・依存種別(runtime/dev)・悪用中フラグ等からスコアを算出する機能を提供すること。
- 設定画面で、Severity 重み・devDependencies ペナルティ・悪用中ボーナス等を編集可能とすること。
- 算出されたスコアに基づき、脆弱性をカテゴリ（IMMEDIATE / SOON / LATER 等）に分類すること。

### 7.7 プロジェクト管理機能

- デモユーザーのみ、解析結果を「プロジェクト」として保存できること。
- プロジェクトには名称を付与できること。
- プロジェクト一覧をサイドバーに表示し、選択したプロジェクトの結果を再表示できること。
- 必要に応じて「再スキャン」を実行し、最新の脆弱性情報に更新できること。

### 7.8 ログイン（デモ）機能

- 画面右上のボタンから「デモとしてログイン」できること。
- ログイン状態はブラウザ内（localStorage 等）で保持し、リロード後も継続されること。
- ログアウト操作により、デモユーザー状態と保存済みプロジェクトをリセットできること（仕様は後続の詳細設計で確定）。

---

## 8. 非機能要件

### 8.1 パフォーマンス

- 依存パッケージ数 100〜200 件程度の `package.json` に対して、通常数秒〜十数秒程度で解析結果を表示できることを目標とする。
- OSV.dev API 呼び出しにはタイムアウトを設定し、最大 30 秒を超えた場合はエラーとして扱うこと。

### 8.2 セキュリティ

- アップロードされた `package.json` はブラウザ内で扱い、サーバーサイドの永続化は行わないこと。
- OSV.dev へのリクエストには、パッケージ名・バージョン・エコシステム以外の機密情報を含めないこと。
- 本システムはポートフォリオ用途であり、本番レベルの包括的なセキュリティ対策はスコープ外とすることを明記する。

### 8.3 信頼性

- OSV.dev API 障害時に、ユーザーへ分かりやすいエラーメッセージを表示すること。
- 予期しないエラー発生時にはアプリが完全にクラッシュしないようにガードし、汎用的なエラーメッセージを表示すること。

### 8.4 利用環境

- 対象ブラウザ：最新の Chrome / Edge を主対象とする。
- PC での利用を主としつつ、タブレット・スマホでも基本的な操作が可能なレスポンシブ対応とする。

---

## 9. 今後の検討事項（詳細設計以降）

- SSVC スコア計算式の具体的な定義とカテゴリ区分値。
- `/api/scan` の Request/Response JSON スキーマ詳細。
- `localStorage` に保存するデータ構造（キー名、JSON 形式）。
- ログイン／ログアウト時の挙動（保存データの扱い）。
- Storybook とテストの対象範囲・テストケース設計。

本要件定義書に基づき、基本設計・詳細設計・実装を進める。
